# Next Train Wear

## Issue Tracker

## Version 5

* [ ] :bangbang: Не отключается GPS, `removeLocationUpdates` не отписывается.

## Version 4

* [x] :warning: Используется старое местоположение.
* [x] :thought_balloon: Обновить SDK.
* [x] :thought_balloon: Убрать ограничение на число ближайших станций.

## Version 3

* [x] :thought_balloon: Голландский язык.
* [x] :thought_balloon: Иногда используется старое местоположение, исправляется если открыть карты. Возможно, из-за параметров запроса местоположения.

### Version 2

* [x] :bangbang: Приложение падает в режиме полета.
* [x] :thought_balloon: Кэшировать ответы API.
* [x] :thought_balloon: Обратный отсчет.
* [x] :thought_balloon: Логгировать запросы к API в Google Analytics.
* [x] :thought_balloon: Отображать отсутствие рейсов.
* [x] :thought_balloon: Затенять экран в ambient mode.
* [x] :thought_balloon: Обновление статуса рейса.
* [x] :thought_balloon: Прокручивать список рейсов, когда поезд уходит.
* [x] :thought_balloon: Улучшить отображение отсутствия рейсов: добавить станцию отправления, выделить станции жирным шрифтом и вывести текущее время.
* [x] :bangbang: Таймер перестает обновляться в ambient mode, система все же засыпает. Вариант: периодически будить `AlarmManager`-ом.
* [x] :thought_balloon: Скрыть экран настроек до следующего обновления.
* [x] :warning: Не отображаются опаздывающие рейсы, если planned departure time прошло.
* [x] :warning: Добавить маршрут в аналитику события `call_train_planner` и проверить, почему не видны значения параметров `departure_code` и `destination_code`.
* [x] :thought_balloon: Проверить, что `onAttached` и `onDetached` работают как ожидается.
* [x] :warning: Кэш не должен зависеть от UI.
* [x] :bangbang: Приложение продолжает отправлять запросы в закрытом состоянии (нужно поскроллить вправо-влево перед закрытием).
* [x] :bangbang: Несмотря на стабильные ID, список рейсов не сохраняет текущую позицию при обновлении. Вызвано обновлением рейсов.
* [x] :bangbang: Иногда отображаемый рейс переключается на следующий еще до отправления. Наверное, это связано с обновлением списка рейсов.
* [x] :bangbang: Кэш хранит данные вечно, в результате можно увидеть расписание из прошлого.
* [x] ~~:thought_balloon: Добавить стабильные ID в адаптеры.~~

## Notes

* [ ] :warning: При отправлении поезда список рейсов иногда прокручивается на много позиций вместо следующей.
* [ ] :warning: При прокрутке станций назначения таймер обновляется только у левого видимого маршрута.
* [ ] :warning: При переоткрытии приложения через большое время отображается старый рейс.
* [ ] :thought_balloon: В ambient mode отображать примерное время отправления ("2 min") и убрать wakelock.
* [ ] :thought_balloon: Уведомлять про изменение или отмену рейса.
* [ ] :thought_balloon: Выделять цветом отправившиеся рейсы.
* [ ] :thought_balloon: Прокрутка рейсов запястьем.
* [ ] :thought_balloon: Отображать число пересадок.
* [ ] :thought_balloon: Поддержка кеширующего сервера. Добавить конфигурацию для nginx. Приложение должно сначала обращаться к кешу и лишь при ошибке – к основному NS API.
* [ ] :thought_balloon: Переместить иконку отсутствия GPS вверх, а вместо нее поместить звездочку, если станция – избранная.
* [ ] :thought_balloon: Настройка для вибрации незадолго до отправления рейса.
* [ ] :thought_balloon: Экран настроек.
* [ ] :thought_balloon: Настройка для отключения вибрации при отправлении поезда.
* [ ] :thought_balloon: Выделять изменение платформы.
* [ ] :thought_balloon: Показывать отмеченные станции вверху списка.
* [ ] :thought_balloon: Поиск станций в списке.
* [ ] :thought_balloon: Выводить тип поезда.
* [ ] :thought_balloon: Выводить длину поезда и удобства.
* [ ] :thought_balloon: Выключать фильтрацию отмененных рейсов в настройках и выделять их цветом фона. Помнить про фон в ambient mode.
* [ ] :thought_balloon: Ручной выбор станции отправления, разрешить работу без GPS.
* [ ] :thought_balloon: Подумать над редизайном экрана с обратным отсчетом.
* [ ] :thought_balloon: Обучающие подсказки.
* [ ] :thought_balloon: Отключать сглаживание в ambient mode.
* [ ] :thought_balloon: Отключать анимацию в ambient mode.
* [ ] :thought_balloon: Выводить текущее время на экране с рейсом.
* [ ] :thought_balloon: Exponential backoff на вызове `trainPlanner`.
* [ ] :thought_balloon: Включать/выключать текущее местоположение в настройках.
* [ ] :thought_balloon: Режим слежения за рейсом в пути. Обратный отсчет до прибытия и будильник.
* [ ] :thought_balloon: Периодически обновлять местоположение и станцию отправления, сохраняя станцию прибытия. Это позволит ехать с запущенным приложением и быстро подгружать пересадки. Помнить про сохранение станции назначения.
* [ ] :thought_balloon: Отображать статус рейса (опаздывает, отправился, отменен).
* [ ] :thought_balloon: Маршрут с самым ранним отправлением – не всегда самый быстрый.
* [ ] :thought_balloon: Выделять оптимальные маршруты.
* [ ] ~~:thought_balloon: Подумать, что сделать с числом ближайших станций (может, найти по расстоянию?).~~
* [ ] ~~:warning: Не обновлять `JourneyOptionsAdapter`, если данные не изменились.~~
* [ ] ~~:thought_balloon: Отправлять запрос только когда прокрутка завершена (debouncing). Возможно, добавить задержку перед запросом.~~
